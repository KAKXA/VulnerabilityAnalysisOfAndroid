import json

from cleaner.src.fill_cve_summary import fillCveSummary
from cleaner.src.fill_earliest_month import fillEarliestMonth
from cleaner.src.utils.load import loadAll
from config import *
from scraper.src.utils.json_dump import jsonDump

from clean_references import cleanRefsAndCweList
from merge import merge

if __name__ == "__main__":

    processes = [False, False, True, True]

    if processes[0]:
        afterMergeCveList = merge()
        with open(afterMergeJson, "w") as fp:
            json.dump(afterMergeCveList, fp)

    if processes[1]:
        afterFillCveSummary = fillCveSummary(loadAll(afterMergeJson))
        with open(afterFillCveSummaryJson, "w") as fp:
            json.dump(afterFillCveSummary, fp)

    if processes[2]:
        afterCleanRefs = cleanRefsAndCweList(loadAll(afterFillCveSummaryJson))
        jsonDump(afterCleanRefsJson, afterCleanRefs)

    if processes[3]:
        afterFillEarliestMonth = fillEarliestMonth(loadAll(afterCleanRefsJson))
        jsonDump(afterFillEarliestMonthJson, afterFillEarliestMonth)
