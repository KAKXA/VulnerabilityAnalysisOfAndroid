import os
import re
import json
import inspect

firstCaller = inspect.stack()[-1].filename

if re.search('test', firstCaller):
    print('Using test/config.json')
    configFile = 'test\\config.json'
else:
    print('Using config.json')
    configFile = 'config.json'

with open(configFile, 'r') as fp:
    allConf = json.load(fp)

cwd = allConf['cwd']
# Scraper #########################
resourcesPath = os.path.join(cwd, allConf['scraper']['resourcesPath'])
androidBulletinHtml = os.path.join(cwd, allConf['scraper']['androidBulletinHtml'])
androidBulletinJson = os.path.join(cwd, allConf['scraper']['androidBulletinJson'])
androidBulletinsDirectory = os.path.join(cwd, allConf['scraper']['androidBulletinsDirectory'])
resolvedAndroidBulletinJson = os.path.join(cwd, allConf['scraper']['resolvedAndroidBulletinJson'])
# Scraper #########################

# Bulletin ##############
domain = 'https://source.android.com'
divClass = "devsite-article-body clearfix"
androidBulletinDivClass = "devsite-article-body clearfix"
androidBulletinUrl = "https://source.android.com/security/bulletin"
# Android Bulletin ##############

# CVE #########################
types = {'RCE', 'EOP', 'ID', 'DOS'}
referencePrefix = {'A','QC','M','N','B','U'}
severities = {'CRITICAL','HIGH','MODERATE','LOW','NSI'}
aospVersionPattern = '\d+[\\.\d*]*[ AND BELOW]?'
aospVersionPatternsAndSplitPatterns = [
    ['\d+[\\.\d+]*', 'NOSP'], # no need to split in this kind of pattern
    ['\d+[\\.\d+]*L', 'NOSP'], # no need to split in this kind of pattern
    ['\d+[\\.\d+]* AND \d+[\\.\d+]*', ' AND '],
    ['\d+[\\.\d+]* - \d+[\\.\d+]*', 'NOSP'], # deal with it after all versions are get
    ['\d+[\\.\d+]* AND BELOW', 'NOSP'] # deal with it after all versions are get
]
# CVE #########################

# GET CVE LIST #########################
_col2MethodName = dict()
_col2MethodName['CVE']='setCveId'
_col2MethodName['REFERENCES']='setReferences'
_col2MethodName['BUG WITH AOSP LINKS']='setReferences'
_col2MethodName['BUG(S) WITH AOSP LINKS']='setReferences'
_col2MethodName['TYPE']='setType'
_col2MethodName['SEVERITY']='setSeverity'
_col2MethodName['UPDATED AOSP VERSIONS']='setUpdatedAospVersions'
_col2MethodName['AFFECTED VERSIONS']='setUpdatedAospVersions'
_col2MethodName['COMPONENT']='setComponent' 
def col2MethodName(col: str) -> str:
    return _col2MethodName[col.upper()]
cveDbConf = allConf['db']
# GET CVE LIST #########################