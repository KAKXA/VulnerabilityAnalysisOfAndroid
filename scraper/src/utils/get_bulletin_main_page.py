import json
from black import os
from bs4 import BeautifulSoup
from utils import get_html, json_dump
from model.android_bulletin_model import AndroidBulletinModel

def getMainPage(mainPageUrl, mainPageLocalPath, mainPageJson) -> list:
    # get bs
    if not os.path.exists(mainPageJson):
        html = get_html.getHtml(mainPageUrl, mainPageLocalPath)
        bs = BeautifulSoup(html, features='html.parser')

        # find div->table->tr->td
        div = bs.find('div', class_="devsite-article-body clearfix")
        table = div.find(name='table')
        bulletins = []
        for tr in table.find_all(name='tr'):
            cnt = 0
            path = ''
            dateStr = ''
            for td in tr.find_all(name='td'):
                if cnt == 0:
                    path = td.find('a').get('href')
                elif cnt == 2:
                    dateStr = td.get_text()
                cnt += 1
            if dateStr != '':
                bulletins.append(AndroidBulletinModel(path.split('/')[-1], dateStr).toJson())

        json_dump.jsonDump(mainPageJson, bulletins)
    else:
        with open(mainPageJson, 'r') as fp:
            bulletins = json.load(fp)

    return bulletins
