from datetime import date
from model.db import DB
from config import *
from scraper.src.utils.convertor import date2Str

def getAndroidCveList():
    db = DB(cveDbConf)
    # wait for modify
    db._cursor.execute("SELECT COLUMN_NAME FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = 'vaoa' and TABLE_NAME = 'cve'")
    allColumnsTuples = db._cursor.fetchall()
    allColumns = [_[0] for _ in allColumnsTuples]

    db._cursor.execute('select * from cve')

    res = []
    for cveRow in db._cursor.fetchall():
        cveRowDict = dict()
        for i in range(len(allColumns)):
            if isinstance(cveRow[i], date):
                cveRowDict[allColumns[i]] = date2Str(cveRow[i])
            else:
                cveRowDict[allColumns[i]] = cveRow[i]
        res.append(cveRowDict)

    with open(androidCveJson, 'w') as fp:
        json.dump(res, fp)

if __name__ == '__main__':
    getAndroidCveList()