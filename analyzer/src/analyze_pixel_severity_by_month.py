from analyzer.src.utils.get_date_map_to_cve_sub_list import getDateMapToCveSubList

def analyzePixelSeverityByMonth(cveList):
	allCnt = 0
	x = ['NSI', 'LOW', 'MODERATE', 'HIGH', 'CRITICAL']
	sevMap = {'NSI': 0, 'LOW': 1, 'MODERATE': 2, 'HIGH': 3, 'CRITICAL': 4}
	y = [0] * 5
	key = 'pixelSeverity'
	dateMapToCveSubList = getDateMapToCveSubList(cveList)
	yByMonth = []
	for date, cveSubList in dateMapToCveSubList:
		curY = [0] * 5
		for cveDict in cveSubList:
			val = cveDict[key]
			if val:
				val = val.upper().strip('\n ')
				allCnt += 1
				y[sevMap[val]] += 1
				curY[sevMap[val]] += 1
		yByMonth.append([date, curY])
	dataByMonth = list(zip(*yByMonth))
	dataByMonth[1] = list(zip(*dataByMonth[1]))
	return {'cveWithPixelSeverityCount': allCnt, 'generalData': [x, y], 'dataByMonth': dataByMonth}