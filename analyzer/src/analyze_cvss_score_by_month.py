from math import ceil
from analyzer.src.utils.dict_to_list_and_sort import dictToListAndSortAndZip

from analyzer.src.utils.get_date_map_to_cve_sub_list import getDateMapToCveSubList
def analyzeCvssScoreByMonth(cveList):
	allCnt = 0
	x = [str(i) + '.1' + '~' + str(i + 1) for i in range(10)]
	y = [0] * 10
	dateMapToCveSubList = getDateMapToCveSubList(cveList)
	yByMonth = []
	for date, cveSubList in dateMapToCveSubList:
		curY = [0 for i in range(10)]
		for cveDict in cveSubList:
			cvssScore = cveDict['cvssScore']
			if cvssScore:
				allCnt += 1
				y[ceil(float(cvssScore)) - 1] += 1
				curY[ceil(float(cvssScore)) - 1] += 1
		yByMonth.append([date, curY])
	# [date1, date2, date3]
	# [curY1, curY2]
	# date1: curY1, date2: curY
	dataByMonth = list(zip(*yByMonth))
	dataByMonth[1] = list(zip(*dataByMonth[1]))
	return {'cveWithCvssScoreCount': allCnt, 'generalData': [x, y], 'dataByMonth': dataByMonth}